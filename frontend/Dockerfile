# ===============================
# Stage 1 ‚Äî build Next.js
# ===============================
FROM node:20-alpine AS builder

WORKDIR /app

COPY frontend/package*.json ./
RUN npm install

COPY frontend/ .

# üî• –û—Ç–∫–ª—é—á–∞–µ–º Turbopack –≤ Next 16 canary
ENV NEXT_DISABLE_TURBOPACK=1

RUN npm run build

# ===============================
# Stage 2 ‚Äî nginx static server
# ===============================
FROM nginx:alpine

# –£–¥–∞–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥
RUN rm /etc/nginx/conf.d/default.conf

# –ö–ª–∞–¥—ë–º –Ω–∞—à –∫–æ–Ω—Ñ–∏–≥
COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf

# –ö–ª–∞–¥—ë–º –±–∏–ª–¥
COPY --from=builder /app/out /usr/share/nginx/html

EXPOSE 80